import Foundation
import SwiftUI

class LocalizationManager: ObservableObject {
    static let shared = LocalizationManager()
    
    @Published var currentLanguage: Language = .english
    @Published var currentCurrency: Currency = .usd
    
    private init() {
        loadSettings()
    }
    
    enum Language: String, CaseIterable {
        case english = "en"
        case hebrew = "he"
        
        var displayName: String {
            switch self {
            case .english: return "English"
            case .hebrew: return "×¢×‘×¨×™×ª"
            }
        }
        
        var isRTL: Bool {
            switch self {
            case .english: return false
            case .hebrew: return true
            }
        }
    }
    
    enum Currency: String, CaseIterable {
        case usd = "USD"
        case ils = "ILS"
        case eur = "EUR"
        case gbp = "GBP"
        
        var symbol: String {
            switch self {
            case .usd: return "$"
            case .ils: return "â‚ª"
            case .eur: return "â‚¬"
            case .gbp: return "Â£"
            }
        }
        
        var displayName: String {
            switch self {
            case .usd: return "US Dollar"
            case .ils: return "Israeli Shekel"
            case .eur: return "Euro"
            case .gbp: return "British Pound"
            }
        }
    }
    
    // MARK: - Localized Strings
    
    func localizedString(for key: String) -> String {
        switch currentLanguage {
        case .english:
            return englishStrings[key] ?? key
        case .hebrew:
            return hebrewStrings[key] ?? englishStrings[key] ?? key
        }
    }
    
    func formatCurrency(_ amount: Double) -> String {
        let formatter = NumberFormatter()
        formatter.numberStyle = .currency
        formatter.currencyCode = currentCurrency.rawValue
        formatter.locale = Locale(identifier: currentLanguage.rawValue)
        
        return formatter.string(from: NSNumber(value: amount)) ?? "\(currentCurrency.symbol)\(String(format: "%.2f", amount))"
    }
    
    func formatTime(_ timeInterval: TimeInterval) -> String {
        let hours = Int(timeInterval) / 3600
        let minutes = Int(timeInterval) % 3600 / 60
        let seconds = Int(timeInterval) % 60
        
        return String(format: "%02d:%02d:%02d", hours, minutes, seconds)
    }
    
    // MARK: - Settings Management
    
    private func loadSettings() {
        if let savedLanguage = UserDefaults.standard.string(forKey: "selectedLanguage"),
           let language = Language(rawValue: savedLanguage) {
            currentLanguage = language
        }
        
        if let savedCurrency = UserDefaults.standard.string(forKey: "selectedCurrency"),
           let currency = Currency(rawValue: savedCurrency) {
            currentCurrency = currency
        }
    }
    
    func setLanguage(_ language: Language) {
        currentLanguage = language
        UserDefaults.standard.set(language.rawValue, forKey: "selectedLanguage")
    }
    
    func setCurrency(_ currency: Currency) {
        currentCurrency = currency
        UserDefaults.standard.set(currency.rawValue, forKey: "selectedCurrency")
    }
    
    // MARK: - String Dictionaries
    
    private let englishStrings: [String: String] = [
        // Navigation
        "nav.dashboard": "Dashboard",
        "nav.time_tracking": "Time Tracking",
        "nav.jobs": "Jobs",
        "nav.history": "History",
        "nav.analytics": "Analytics",
        "nav.settings": "Settings",
        
        // Dashboard
        "dashboard.welcome": "Welcome back!",
        "dashboard.good_morning": "Good morning!",
        "dashboard.good_afternoon": "Good afternoon!",
        "dashboard.good_evening": "Good evening!",
        "dashboard.current_status": "Current Status",
        "dashboard.not_tracking": "Not tracking time",
        "dashboard.tracking": "Tracking time",
        "dashboard.quick_actions": "Quick Actions",
        "dashboard.start_shift": "Start Shift",
        "dashboard.add_job": "Add Job",
        "dashboard.add_shift": "Add Shift",
        "dashboard.jobs_overview": "Jobs Overview",
        "dashboard.no_jobs": "No jobs yet",
        "dashboard.add_first_job": "Add your first job to get started",
        "dashboard.recent_activity": "Recent Activity",
        "dashboard.no_activity": "No recent activity",
        "dashboard.earnings_goals": "Earnings Goals",
        "dashboard.tap_to_set_goals": "Tap to set goals and track progress",
        
        // Time Tracking
        "time_tracking.ready": "READY",
        "time_tracking.tracking": "TRACKING",
        "time_tracking.start_shift": "Start Shift",
        "time_tracking.end_shift": "End Shift",
        "time_tracking.select_job": "Select Job",
        "time_tracking.no_jobs_available": "No jobs available",
        "time_tracking.add_job_first": "Add a job first to start tracking",
        "time_tracking.notes": "Notes",
        "time_tracking.add_notes": "Add notes about this shift...",
        "time_tracking.characters": "characters",
        "time_tracking.notes_saved": "Notes will be saved with your shift",
        
        // Jobs
        "jobs.title": "Jobs",
        "jobs.add_job": "Add Job",
        "jobs.edit_job": "Edit Job",
        "jobs.job_name": "Job Name",
        "jobs.hourly_rate": "Hourly Rate",
        "jobs.bonuses": "Bonuses",
        "jobs.add_bonus": "Add Bonus",
        "jobs.bonus_name": "Bonus Name",
        "jobs.bonus_amount": "Amount",
        "jobs.total_hours": "Total Hours",
        "jobs.total_earnings": "Total Earnings",
        "jobs.no_jobs": "No jobs yet",
        "jobs.add_first_job": "Add your first job to get started",
        
        // History
        "history.title": "History",
        "history.export": "Export",
        "history.export_csv": "Export as CSV",
        "history.export_pdf": "Export as PDF",
        "history.no_shifts": "No shifts recorded",
        "history.start_recording": "Start recording shifts to see them here",
        
        // Analytics
        "analytics.title": "Analytics",
        "analytics.total_earnings": "Total Earnings",
        "analytics.total_hours": "Total Hours",
        "analytics.average_rate": "Average Rate",
        "analytics.earnings_breakdown": "Earnings Breakdown",
        "analytics.regular": "Regular",
        "analytics.overtime": "Overtime",
        "analytics.special": "Special",
        "analytics.bonus": "Bonus",
        "analytics.top_jobs": "Top Jobs",
        "analytics.no_data": "No data available",
        "analytics.start_tracking": "Start tracking to see analytics",
        
        // Settings
        "settings.title": "Settings",
        "settings.language": "Language",
        "settings.currency": "Currency",
        "settings.notifications": "Notifications",
        "settings.manage_reminders": "Manage Shift Reminders",
        "settings.data_management": "Data Management",
        "settings.export_data": "Export Data",
        "settings.about": "About",
        "settings.version": "Version",
        "settings.developer": "Developer",
        
        // Earnings Goals
        "goals.title": "Earnings Goals",
        "goals.set_track_targets": "Set and track your financial targets",
        "goals.daily": "Daily",
        "goals.weekly": "Weekly",
        "goals.monthly": "Monthly",
        "goals.progress": "Progress",
        "goals.goal_achieved": "Goal Achieved! ðŸŽ‰",
        "goals.edit_goal": "Edit Goal",
        "goals.goal_amount": "Goal Amount",
        "goals.quick_set": "Quick Set",
        "goals.save_goal": "Save Goal",
        "goals.today": "Today",
        "goals.this_week": "This Week",
        "goals.this_month": "This Month",
        
        // Shift Reminders
        "reminders.title": "Shift Reminders",
        "reminders.stay_on_track": "Stay on track with smart notifications",
        "reminders.notification_status": "Notification Status",
        "reminders.enabled": "Notifications are enabled",
        "reminders.disabled": "Notifications are disabled",
        "reminders.enable": "Enable",
        "reminders.shift_reminders": "Shift Reminders",
        "reminders.start_reminder": "Start Shift Reminder",
        "reminders.end_reminder": "End Shift Reminder",
        "reminders.remind_me_at": "Remind me at:",
        "reminders.daily_reminders": "Daily Reminders",
        "reminders.daily_work_reminder": "Daily Work Reminder",
        "reminders.weekly_summary": "Weekly Summary",
        "reminders.weekly_earnings_summary": "Weekly Earnings Summary",
        "reminders.send_summary_on": "Send summary on:",
        "reminders.test_notifications": "Test Notifications",
        "reminders.send_test": "Send Test Notification",
        "reminders.sending": "Sending...",
        
        // Common
        "common.done": "Done",
        "common.cancel": "Cancel",
        "common.save": "Save",
        "common.edit": "Edit",
        "common.delete": "Delete",
        "common.add": "Add",
        "common.remove": "Remove",
        "common.yes": "Yes",
        "common.no": "No",
        "common.ok": "OK",
        "common.error": "Error",
        "common.success": "Success",
        "common.warning": "Warning",
        "common.info": "Info",
        
        // Additional common strings
        "common.loading": "Loading...",
        "common.retry": "Retry",
        "common.close": "Close",
        "common.next": "Next",
        "common.previous": "Previous",
        "common.continue": "Continue",
        "common.finish": "Finish",
        "common.back": "Back",
        "common.forward": "Forward",
        "common.refresh": "Refresh",
        "common.search": "Search",
        "common.filter": "Filter",
        "common.sort": "Sort",
        "common.clear": "Clear",
        "common.reset": "Reset",
        "common.apply": "Apply",
        "common.confirm": "Confirm",
        "common.discard": "Discard",
        "common.undo": "Undo",
            "common.redo": "Redo",
            
            // History
    
    private let hebrewStrings: [String: String] = [
        // Navigation
        "nav.dashboard": "×œ×•×— ×‘×§×¨×”",
        "nav.time_tracking": "×ž×¢×§×‘ ×–×ž×Ÿ",
        "nav.jobs": "×¢×‘×•×“×•×ª",
        "nav.history": "×”×™×¡×˜×•×¨×™×”",
        "nav.analytics": "×× ×œ×™×˜×™×§×”",
        "nav.settings": "×”×’×“×¨×•×ª",
        
        // Dashboard
        "dashboard.welcome": "×‘×¨×•×›×™× ×”×©×‘×™×!",
        "dashboard.good_morning": "×‘×•×§×¨ ×˜×•×‘!",
        "dashboard.good_afternoon": "××—×¨ ×”×¦×”×¨×™×™× ×˜×•×‘×™×!",
        "dashboard.good_evening": "×¢×¨×‘ ×˜×•×‘!",
        "dashboard.current_status": "×¡×˜×˜×•×¡ × ×•×›×—×™",
        "dashboard.not_tracking": "×œ× ×¢×•×§×‘ ××—×¨ ×–×ž×Ÿ",
        "dashboard.tracking": "×¢×•×§×‘ ××—×¨ ×–×ž×Ÿ",
        "dashboard.quick_actions": "×¤×¢×•×œ×•×ª ×ž×”×™×¨×•×ª",
        "dashboard.start_shift": "×”×ª×—×œ ×ž×©×ž×¨×ª",
        "dashboard.add_job": "×”×•×¡×£ ×¢×‘×•×“×”",
        "dashboard.add_shift": "×”×•×¡×£ ×ž×©×ž×¨×ª",
        "dashboard.jobs_overview": "×¡×§×™×¨×ª ×¢×‘×•×“×•×ª",
        "dashboard.no_jobs": "××™×Ÿ ×¢×‘×•×“×•×ª ×¢×“×™×™×Ÿ",
        "dashboard.add_first_job": "×”×•×¡×£ ××ª ×”×¢×‘×•×“×” ×”×¨××©×•× ×” ×©×œ×š ×›×“×™ ×œ×”×ª×—×™×œ",
        "dashboard.recent_activity": "×¤×¢×™×œ×•×ª ××—×¨×•× ×”",
        "dashboard.no_activity": "××™×Ÿ ×¤×¢×™×œ×•×ª ××—×¨×•× ×”",
        "dashboard.earnings_goals": "×™×¢×“×™ ×¨×•×•×—×™×",
        "dashboard.tap_to_set_goals": "×”×§×© ×›×“×™ ×œ×”×’×“×™×¨ ×™×¢×“×™× ×•×œ×¢×§×•×‘ ××—×¨ ×”×ª×§×“×ž×•×ª",
        
        // Time Tracking
        "time_tracking.ready": "×ž×•×›×Ÿ",
        "time_tracking.tracking": "×¢×•×§×‘",
        "time_tracking.start_shift": "×”×ª×—×œ ×ž×©×ž×¨×ª",
        "time_tracking.end_shift": "×¡×™×™× ×ž×©×ž×¨×ª",
        "time_tracking.select_job": "×‘×—×¨ ×¢×‘×•×“×”",
        "time_tracking.no_jobs_available": "××™×Ÿ ×¢×‘×•×“×•×ª ×–×ž×™× ×•×ª",
        "time_tracking.add_job_first": "×”×•×¡×£ ×¢×‘×•×“×” ×§×•×“× ×›×“×™ ×œ×”×ª×—×™×œ ×ž×¢×§×‘",
        "time_tracking.notes": "×”×¢×¨×•×ª",
        "time_tracking.add_notes": "×”×•×¡×£ ×”×¢×¨×•×ª ×¢×œ ×”×ž×©×ž×¨×ª ×”×–×•...",
        "time_tracking.characters": "×ª×•×•×™×",
        "time_tracking.notes_saved": "×”×¢×¨×•×ª ×™×™×©×ž×¨×• ×¢× ×”×ž×©×ž×¨×ª ×©×œ×š",
        
        // Jobs
        "jobs.title": "×¢×‘×•×“×•×ª",
        "jobs.add_job": "×”×•×¡×£ ×¢×‘×•×“×”",
        "jobs.edit_job": "×¢×¨×•×š ×¢×‘×•×“×”",
        "jobs.job_name": "×©× ×”×¢×‘×•×“×”",
        "jobs.hourly_rate": "×©×›×¨ ×©×¢×ª×™",
        "jobs.bonuses": "×‘×•× ×•×¡×™×",
        "jobs.add_bonus": "×”×•×¡×£ ×‘×•× ×•×¡",
        "jobs.bonus_name": "×©× ×”×‘×•× ×•×¡",
        "jobs.bonus_amount": "×¡×›×•×",
        "jobs.total_hours": "×¡×”\"×› ×©×¢×•×ª",
        "jobs.total_earnings": "×¡×”\"×› ×¨×•×•×—×™×",
        "jobs.no_jobs": "××™×Ÿ ×¢×‘×•×“×•×ª ×¢×“×™×™×Ÿ",
        "jobs.add_first_job": "×”×•×¡×£ ××ª ×”×¢×‘×•×“×” ×”×¨××©×•× ×” ×©×œ×š ×›×“×™ ×œ×”×ª×—×™×œ",
        
        // History
        "history.title": "×”×™×¡×˜×•×¨×™×”",
        "history.export": "×™×™×¦×",
        "history.export_csv": "×™×™×¦× ×›-CSV",
        "history.export_pdf": "×™×™×¦× ×›-PDF",
        "history.no_shifts": "××™×Ÿ ×ž×©×ž×¨×•×ª ×¨×©×•×ž×•×ª",
        "history.start_recording": "×”×ª×—×œ ×œ×”×§×œ×™×˜ ×ž×©×ž×¨×•×ª ×›×“×™ ×œ×¨××•×ª ××•×ª×Ÿ ×›××Ÿ",
        
        // Analytics
        "analytics.title": "×× ×œ×™×˜×™×§×”",
        "analytics.total_earnings": "×¡×”\"×› ×¨×•×•×—×™×",
        "analytics.total_hours": "×¡×”\"×› ×©×¢×•×ª",
        "analytics.average_rate": "×©×›×¨ ×ž×ž×•×¦×¢",
        "analytics.earnings_breakdown": "×¤×™×¨×•×˜ ×¨×•×•×—×™×",
        "analytics.regular": "×¨×’×™×œ",
        "analytics.overtime": "×©×¢×•×ª × ×•×¡×¤×•×ª",
        "analytics.special": "×ž×™×•×—×“",
        "analytics.bonus": "×‘×•× ×•×¡",
        "analytics.top_jobs": "×¢×‘×•×“×•×ª ×ž×•×‘×™×œ×•×ª",
        "analytics.no_data": "××™×Ÿ × ×ª×•× ×™× ×–×ž×™× ×™×",
        "analytics.start_tracking": "×”×ª×—×œ ×ž×¢×§×‘ ×›×“×™ ×œ×¨××•×ª ×× ×œ×™×˜×™×§×”",
        
        // Settings
        "settings.title": "×”×’×“×¨×•×ª",
        "settings.language": "×©×¤×”",
        "settings.currency": "×ž×˜×‘×¢",
        "settings.notifications": "×”×ª×¨××•×ª",
        "settings.manage_reminders": "× ×”×œ ×ª×–×›×•×¨×•×ª ×ž×©×ž×¨×ª",
        "settings.data_management": "× ×™×”×•×œ × ×ª×•× ×™×",
        "settings.export_data": "×™×™×¦× × ×ª×•× ×™×",
        "settings.about": "××•×“×•×ª",
        "settings.version": "×’×¨×¡×”",
        "settings.developer": "×ž×¤×ª×—",
        
        // Earnings Goals
        "goals.title": "×™×¢×“×™ ×¨×•×•×—×™×",
        "goals.set_track_targets": "×”×’×“×¨ ×•×¢×§×•×‘ ××—×¨ ×™×¢×“×™× ×¤×™× × ×¡×™×™×",
        "goals.daily": "×™×•×ž×™",
        "goals.weekly": "×©×‘×•×¢×™",
        "goals.monthly": "×—×•×“×©×™",
        "goals.progress": "×”×ª×§×“×ž×•×ª",
        "goals.goal_achieved": "×™×¢×“ ×”×•×©×’! ðŸŽ‰",
        "goals.edit_goal": "×¢×¨×•×š ×™×¢×“",
        "goals.goal_amount": "×¡×›×•× ×™×¢×“",
        "goals.quick_set": "×”×’×“×¨×” ×ž×”×™×¨×”",
        "goals.save_goal": "×©×ž×•×¨ ×™×¢×“",
        "goals.today": "×”×™×•×",
        "goals.this_week": "×”×©×‘×•×¢",
        "goals.this_month": "×”×—×•×“×©",
        
        // Shift Reminders
        "reminders.title": "×ª×–×›×•×¨×•×ª ×ž×©×ž×¨×ª",
        "reminders.stay_on_track": "×”×™×©××¨ ×¢×œ ×”×ž×¡×œ×•×œ ×¢× ×”×ª×¨××•×ª ×—×›×ž×•×ª",
        "reminders.notification_status": "×¡×˜×˜×•×¡ ×”×ª×¨××•×ª",
        "reminders.enabled": "×”×ª×¨××•×ª ×ž×•×¤×¢×œ×•×ª",
        "reminders.disabled": "×”×ª×¨××•×ª ×ž×•×©×‘×ª×•×ª",
        "reminders.enable": "×”×¤×¢×œ",
        "reminders.shift_reminders": "×ª×–×›×•×¨×•×ª ×ž×©×ž×¨×ª",
        "reminders.start_reminder": "×ª×–×›×•×¨×ª ×”×ª×—×œ×ª ×ž×©×ž×¨×ª",
        "reminders.end_reminder": "×ª×–×›×•×¨×ª ×¡×™×•× ×ž×©×ž×¨×ª",
        "reminders.remind_me_at": "×ª×–×›×¨ ××•×ª×™ ×‘:",
        "reminders.daily_reminders": "×ª×–×›×•×¨×•×ª ×™×•×ž×™×•×ª",
        "reminders.daily_work_reminder": "×ª×–×›×•×¨×ª ×¢×‘×•×“×” ×™×•×ž×™×ª",
        "reminders.weekly_summary": "×¡×™×›×•× ×©×‘×•×¢×™",
        "reminders.weekly_earnings_summary": "×¡×™×›×•× ×¨×•×•×—×™× ×©×‘×•×¢×™",
        "reminders.send_summary_on": "×©×œ×— ×¡×™×›×•× ×‘:",
        "reminders.test_notifications": "×‘×“×™×§×ª ×”×ª×¨××•×ª",
        "reminders.send_test": "×©×œ×— ×”×ª×¨××” ×œ×‘×“×™×§×”",
        "reminders.sending": "×©×•×œ×—...",
        
        // Common
        "common.done": "×¡×™×•×",
        "common.cancel": "×‘×™×˜×•×œ",
        "common.save": "×©×ž×•×¨",
        "common.edit": "×¢×¨×•×š",
        "common.delete": "×ž×—×§",
        "common.add": "×”×•×¡×£",
        "common.remove": "×”×¡×¨",
        "common.yes": "×›×Ÿ",
        "common.no": "×œ×",
        "common.ok": "××™×©×•×¨",
        "common.error": "×©×’×™××”",
        "common.success": "×”×¦×œ×—×”",
        "common.warning": "××–×”×¨×”",
        "common.info": "×ž×™×“×¢",
        
        // Additional common strings
        "common.loading": "×˜×•×¢×Ÿ...",
        "common.retry": "× ×¡×” ×©×•×‘",
        "common.close": "×¡×’×•×¨",
        "common.next": "×”×‘×",
        "common.previous": "×”×§×•×“×",
        "common.continue": "×”×ž×©×š",
        "common.finish": "×¡×™×™×",
        "common.back": "×—×–×•×¨",
        "common.forward": "×§×“×™×ž×”",
        "common.refresh": "×¨×¢× ×Ÿ",
        "common.search": "×—×™×¤×•×©",
        "common.filter": "×¡×™× ×•×Ÿ",
        "common.sort": "×ž×™×•×Ÿ",
        "common.clear": "× ×§×”",
        "common.reset": "××™×¤×•×¡",
        "common.apply": "×”×—×œ",
        "common.confirm": "××©×¨",
        "common.discard": "×”×ª×¢×œ×",
        "common.undo": "×‘×˜×œ",
            "common.redo": "×—×–×•×¨ ×¢×œ",
            
            // History
            "history.title": "×”×™×¡×˜×•×¨×™×”",
            "history.no_shifts": "×œ× × ×ž×¦××• ×ž×©×ž×¨×•×ª",
            "history.add_first_shift": "×”×ª×—×œ ×œ×¢×§×•×‘ ××—×¨ ×”×¢×‘×•×“×” ×©×œ×š ×›×“×™ ×œ×¨××•×ª ××ª ×”×”×™×¡×˜×•×¨×™×” ×›××Ÿ",
            "history.export_data": "×™×™×¦× × ×ª×•× ×™×",
            "history.export_csv": "×™×™×¦× ×›-CSV",
            "history.export_pdf": "×™×™×¦× ×›-PDF",
            "history.total_earnings": "×”×›× ×¡×•×ª ×›×•×œ×œ×•×ª",
            "history.total_hours": "×©×¢×•×ª ×›×•×œ×œ×•×ª",
            "history.average_rate": "×©×›×¨ ×ž×ž×•×¦×¢",
            "history.shifts_count": "×ž×©×ž×¨×•×ª",
            
            // Settings
            "settings.title": "×”×’×“×¨×•×ª",
            "settings.app_info": "×ž×™×“×¢ ×¢×œ ×”××¤×œ×™×§×¦×™×”",
            "settings.version": "×’×¨×¡×”",
            "settings.build": "×‘× ×™×™×”",
            "settings.description": "×¢×§×•×‘ ××—×¨ ×©×¢×•×ª ×”×¢×‘×•×“×” ×©×œ×š, ×—×©×‘ ×”×›× ×¡×•×ª ×•× ×”×œ ××ª ×”×–×ž×Ÿ ×©×œ×š ×‘×™×¢×™×œ×•×ª. × ×‘× ×” ×¢× SwiftUI ×•-Core Data ×œ×¤×•× ×§×¦×™×•× ×œ×™×•×ª ××•×¤×œ×™×™×Ÿ."
        ]
    }

// MARK: - View Extensions

extension View {
    func localizedString(for key: String) -> String {
        LocalizationManager.shared.localizedString(for: key)
    }
}
